begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|jackrabbit
operator|.
name|oak
operator|.
name|segment
operator|.
name|azure
package|;
end_package

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collections
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|Assert
operator|.
name|*
import|;
end_import

begin_class
specifier|public
class|class
name|AzureBlobMetadataTest
block|{
annotation|@
name|Test
specifier|public
name|void
name|toSegmentMetadata
parameter_list|()
block|{
name|AzureSegmentArchiveEntry
name|entry
init|=
operator|new
name|AzureSegmentArchiveEntry
argument_list|(
operator|-
literal|7554506325726244935L
argument_list|,
operator|-
literal|5874985927363300041L
argument_list|,
literal|3
argument_list|,
literal|5
argument_list|,
literal|50
argument_list|,
literal|60
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|HashMap
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|map
init|=
name|AzureBlobMetadata
operator|.
name|toSegmentMetadata
argument_list|(
name|entry
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|"segment"
argument_list|,
name|map
operator|.
name|get
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_TYPE
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"97290085-b1a5-4fb9-ae77-db6d13177537"
argument_list|,
name|map
operator|.
name|get
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_UUID
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"3"
argument_list|,
name|map
operator|.
name|get
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_POSITION
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"50"
argument_list|,
name|map
operator|.
name|get
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_GENERATION
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"60"
argument_list|,
name|map
operator|.
name|get
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_FULL_GENERATION
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"true"
argument_list|,
name|map
operator|.
name|get
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_COMPACTED
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|toIndexEntry
parameter_list|()
block|{
name|HashMap
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|metadata
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_UUID
argument_list|,
literal|"97290085-b1a5-4fb9-ae77-db6d13177537"
argument_list|)
expr_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_POSITION
argument_list|,
literal|"3"
argument_list|)
expr_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_GENERATION
argument_list|,
literal|"50"
argument_list|)
expr_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_FULL_GENERATION
argument_list|,
literal|"60"
argument_list|)
expr_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_COMPACTED
argument_list|,
literal|"true"
argument_list|)
expr_stmt|;
name|AzureSegmentArchiveEntry
name|azureSegmentArchiveEntry
init|=
name|AzureBlobMetadata
operator|.
name|toIndexEntry
argument_list|(
name|metadata
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
name|azureSegmentArchiveEntry
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|-
literal|7554506325726244935L
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getMsb
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|-
literal|5874985927363300041L
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getLsb
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|3
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getPosition
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getLength
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|50
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getGeneration
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|60
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getFullGeneration
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|azureSegmentArchiveEntry
operator|.
name|isCompacted
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|toIndexEntry_caseInsensitive
parameter_list|()
block|{
name|HashMap
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|metadata
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_UUID
operator|.
name|toUpperCase
argument_list|()
argument_list|,
literal|"97290085-b1a5-4fb9-ae77-db6d13177537"
argument_list|)
expr_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_POSITION
operator|.
name|toUpperCase
argument_list|()
argument_list|,
literal|"3"
argument_list|)
expr_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_GENERATION
operator|.
name|toUpperCase
argument_list|()
argument_list|,
literal|"50"
argument_list|)
expr_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_FULL_GENERATION
operator|.
name|toUpperCase
argument_list|()
argument_list|,
literal|"60"
argument_list|)
expr_stmt|;
name|metadata
operator|.
name|put
argument_list|(
name|AzureBlobMetadata
operator|.
name|METADATA_SEGMENT_COMPACTED
operator|.
name|toUpperCase
argument_list|()
argument_list|,
literal|"true"
argument_list|)
expr_stmt|;
name|AzureSegmentArchiveEntry
name|azureSegmentArchiveEntry
init|=
name|AzureBlobMetadata
operator|.
name|toIndexEntry
argument_list|(
name|metadata
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
operator|-
literal|7554506325726244935L
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getMsb
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|-
literal|5874985927363300041L
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getLsb
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|3
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getPosition
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getLength
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|50
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getGeneration
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|60
argument_list|,
name|azureSegmentArchiveEntry
operator|.
name|getFullGeneration
argument_list|()
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|azureSegmentArchiveEntry
operator|.
name|isCompacted
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|isSegment
parameter_list|()
block|{
name|assertTrue
argument_list|(
name|AzureBlobMetadata
operator|.
name|isSegment
argument_list|(
name|Collections
operator|.
name|singletonMap
argument_list|(
literal|"type"
argument_list|,
literal|"segment"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|AzureBlobMetadata
operator|.
name|isSegment
argument_list|(
name|Collections
operator|.
name|singletonMap
argument_list|(
literal|"type"
argument_list|,
literal|"index"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|isSegment_caseInsensitive
parameter_list|()
block|{
name|assertTrue
argument_list|(
name|AzureBlobMetadata
operator|.
name|isSegment
argument_list|(
name|Collections
operator|.
name|singletonMap
argument_list|(
literal|"Type"
argument_list|,
literal|"segment"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|AzureBlobMetadata
operator|.
name|isSegment
argument_list|(
name|Collections
operator|.
name|singletonMap
argument_list|(
literal|"TYPE"
argument_list|,
literal|"segment"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|AzureBlobMetadata
operator|.
name|isSegment
argument_list|(
name|Collections
operator|.
name|singletonMap
argument_list|(
literal|"tYPE"
argument_list|,
literal|"segment"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

